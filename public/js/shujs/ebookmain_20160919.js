var alsobuy_max_pic=5;if(iswidth==false){alsobuy_max_pic=4}var Alsobuy={init:function(){for(var b in Alsobuy){var c=Alsobuy[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},countalsobuy:0,callback:function(){var c="";var b=arguments.length;for(var d=0;d<b;d++){c+=arguments[d]+"&"}c=c.substr(0,c.length-1);c+="&alsobuy_max_pic="+alsobuy_max_pic;$.ajax({url:"/alsobuy/main.php",data:c,type:"GET",cache:false,beforeSend:function(){wait_html='<div style="text-align: center; margin: 30px 0px;" id="alsobuy_wait" isloaded="1"><img border="0" src="images/loading.gif"> 内容加载中，请稍候...</div>';$("#alsobuy").html(wait_html)},success:function(e){if(e.length>0){$("#alsobuy").html(e);Alsobuy.countalsobuy=$("#alsobuy_pic ul").children().length;if(Alsobuy.countalsobuy>alsobuy_max_pic){$("#alsobuy_pic").ddcycle({fx:"scrollHorz",timeout:0,speed:500,next:"#alsobuy_pic_next",prev:"#alsobuy_pic_pre",prevNextClick:Alsobuy.toggleBtn})}else{$("#alsobuy_pic_pre").removeClass("prev").addClass("prev_none").removeAttr("title");$("#alsobuy_pic_next").removeClass("next").addClass("next_none").removeAttr("title")}}else{$("#alsobuy").html("");$("#alsobuy").hide()}}})},toggleBtn:function(d,c,b){if(d&&c==b.length-1){$("#alsobuy_pic_next").hide();$("#a_alsobuy_pic_next").show()}else{$("#alsobuy_pic_next").show();$("#a_alsobuy_pic_next").hide()}if(!d&&c==0){$("#alsobuy_pic_pre").hide();$("#a_alsobuy_pic_pre").show()}else{$("#alsobuy_pic_pre").show();$("#a_alsobuy_pic_pre").hide()}$("#alsobuy_now_page").html(c+1)}};var Bothbuy={init:function(){for(var b in Bothbuy){var c=Bothbuy[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},abtestUrl:"http://shopping.dangdang.com/shoppingcart/cart_init.php?product_ids=",callback:function(){var d="";var b=arguments.length;var c="wide";var e=0;if(!iswidth){c="narrow"}for(e=0;e<b;e++){d+=arguments[e]+"&"}d+="papertype="+c;$.ajax({url:"/bothbuy/bothbuycallback.php",data:d,type:"GET",cache:false,success:function(f){if(f.length>0){$("#bothbuy").html(f);Promotion.get_user_vip_type(Bothbuy.setVipPrice)}else{$("#bothbuy").hide()}}})},setVipPrice:function(){var c=$("#pvs").attr("uvt");var b={vn1:"金卡VIP",vn2:"钻石VIP",vn3:"银卡VIP"};if(c<1){return}var d=b["vn"+c];var g=$("#pvs").attr("pt");if(c&&(g==101||g==102)){var h=0;var f=0;if($("#pvs").attr("vp1"+c)){h=new Number($("#pvs").attr("vp1"+c))}if($("#bbvp").attr("ebp")){f=new Number($("#bbvp").attr("ebp"))}if(h>0&&f>0){var e=Bothbuy.toFixedNum(h+f);$("#bbvp").html("&yen;"+e);$("#bbvp").after('<span style="color:#999">（'+d+"）</span>");$("#bbvp").parent().show()}}},doAddToShoppingCart:function(b,e,f,c,d){if(d=="isabtest"){if(!f){f={x:0,y:0}}$.ajax({url:"/bothbuy/bothbuycallback.php",data:"type=abtest&product_id="+b,type:"GET",success:function(g){if(g=="a"){window.location.href=abtestUrl+b;return false}else{DDCART.ADDCartWin(b,e,f,c)}}})}else{DDCART.ADDCartWin(b,e,f,c)}},toFixedNum:function(b){b=new Number(b);b=b*100;b=b.toFixed(0);b=b/100;if(b<1000){b=b.toFixed(2)}else{if(b>=1000){b=parseFloat(b.toFixed(2))}}return b}};var Alsoview={init:function(){for(var b in Alsoview){var c=Alsoview[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},callback:function(){var c="";var b=arguments.length;for(var d=0;d<b;d++){c+=arguments[d]+"&"}c=c.substr(0,c.length-1);$.ajax({url:"/alsoview/main.php",data:c,type:"GET",cache:false,beforeSend:function(){wait_html='<div style="text-align: center; margin: 30px 0px;" id="detail_wait" isloaded="1"><img border="0" src="images/loading.gif"> 内容加载中，请稍候...</div>';$("#alsoview").html(wait_html)},success:function(e){if(e.length>0){$("#alsoview").html(e)}else{$("#alsoview").html("")}}})}};var Buyafterview={init:function(){for(var b in Buyafterview){var c=Buyafterview[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},callback:function(){var c="";var b=arguments.length;for(var d=0;d<b;d++){c+=arguments[d]+"&"}c=c.substr(0,c.length-1);$.ajax({url:"/buyafterview/main.php",data:c,type:"GET",cache:false,beforeSend:function(){wait_html='<div style="text-align: center; margin: 30px 0px;" id="detail_wait" isloaded="1"><img border="0" src="images/loading.gif"> 内容加载中，请稍候...</div>';$("#buyafterview").html(wait_html)},success:function(e){if(e.length>0){$("#buyafterview").html(e)}else{$("#buyafterview").html("")}}})}};var History={init:function(){for(var b in History){var c=History[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},callback:function(){var c="";var b=arguments.length;for(var d=0;d<b;d++){c+=arguments[d]+"&"}c=c.substr(0,c.length-1);$.ajax({url:"/history/main.php",data:c,cache:false,type:"GET",success:function(e){if(e.length>0){$("#history").html(e)}}})}};var Prdcategory={init:function(){for(var b in Prdcategory){var c=Prdcategory[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},callback:function(){var c="";var b=arguments.length;for(var d=0;d<b;d++){c+=arguments[d]+"&"}c=c.substr(0,c.length-1);$.ajax({url:"/prdcategory/main.php",data:c,cache:false,type:"GET",success:function(e){if(e.length>0){$("#prdcategory").html(e)}}})}};var Detail={init:function(){for(var b in Detail){var c=Detail[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},product_id:0,tab_position:"",beginshow:"detail",callback:function(){var f="";var b=arguments.length;var c="";var e=Detail.beginshow;for(var g=0;g<b;g++){f+=arguments[g]+"&";if(arguments[g].indexOf("product_id=")!=-1&&Detail.product_id==0){var d=arguments[g].replace("product_id=","");if(parseInt(d)>0){Detail.product_id=parseInt(d)}}}f=f.substr(0,f.length-1);$.ajax({url:"/detail/main.php",data:f,cache:false,type:"GET",beforeSend:function(){c='<div style="text-align: center; margin: 30px 0px;" id="detail_wait" isloaded="1"><img border="0" src="images/loading.gif"> 内容加载中，请稍候...</div>';$("#product_tab").html(c)},success:function(j){if(j.length>0){$("#product_tab").html(j);$("#detail_all textarea").siblings("span[id*='_all']").html(function(){return $(this).siblings("textarea").val()});if(typeof Detail.tab_position!="object"){Detail.tab_position=$("#all_tab_div").position()}Detail.bind();Detail.tab();var h=new Date().getTime();$.getScript("/comment/js/ebookcomment.js?t="+h,function(){if(e=="comment"){Comment.showtitle=false}var k=iswidth?"true":"false";Comment.callback("product_id="+Detail.product_id,"iswidth="+k)});$.getScript("/question/js/question.js?t="+h,function(){Question.callback("product_id="+Detail.product_id)});$("#"+e+"_tab").click()}}})},bind:function(){$("#detail_all textarea").siblings("span[id*='_all']").html(function(){return $(this).siblings("textarea").hide().val().replace(/\n/g,"").replace(/<img .*?(src=\n?['"](.*?)['"]).*?>/ig,function(e,d,c){return e.replace(d,'src="images/grey.gif" original="'+c+'"')})});if(typeof Detail.tab_position!="object"){Detail.tab_position=$("#all_tab_panel").offset()}$("#detail_all img").ddlazyload({placeholder:"images/grey.gif",effect:"fadeIn"});$(window).scroll(function(){var c=$(window).scrollTop();var d=$("#review_point").offset();if(c>d.top){if($.browser.msie){$("#all_tab_panel").css({position:"absolute",top:$(window).scrollTop()});$("#pid_span_detail").attr("tabstate","absolute")}else{$("#all_tab_panel").css({position:"fixed",top:"0"})}}if(c<=d.top){if($.browser.msie){if($("#pid_span_detail").attr("tabstate")=="absolute"&&$("#comment_tab").attr("class")=="on"){setTimeout('$("#comment_all").removeClass("comment").addClass("comment")',1)}$("#all_tab_panel").css({position:"relative",top:"0"});$("#pid_span_detail").attr("tabstate","relative")}else{$("#all_tab_panel").css({position:"relative"})}}});$("#product_tab a[id$=_icon],#product_tab p[id$=_link]").die("click").live("click",function(){var d=$(this).attr("id");var c=d.replace("_icon","");c=c.replace("_link","");if($(this).attr("class").indexOf("icon_down")!=-1||$(this).html().indexOf("显示全部信息")!=-1){$("#"+c+"_icon").removeClass("icon_down").addClass("icon_up");$("#"+c+"_link>a").html("显示部分信息");$("#"+c+"_all").show();$("#"+c+"_show").hide()}else{if($(this).attr("class").indexOf("icon_up")!=-1||$(this).html().indexOf("显示部分信息")!=-1){$("#"+c+"_icon").removeClass("icon_up").addClass("icon_down");$("#"+c+"_link>a").html("显示全部信息");$("#"+c+"_show").show();$("#"+c+"_all").hide()}}});$("#product_tab a[id$=_tab]").die("click").live("click",function(){var c=$(this).attr("id").replace("_tab","");Detail.tab();$("#product_tab a[id$=_tab][class*=on]").removeClass();$(this).removeClass().addClass("on");if(parseInt(c)>0){}else{if(c=="detail"){$("div[id$=_all]").show();$("div[id$=_all] h3[class=tit]").show()}else{if($("#"+c+"_tab").attr("isloaded")!=1){if(c=="comment"){Detail.loadComment()}else{if(c="question"){Detail.loadQuestion()}}$("#"+c+"_tab").attr("isloaded",1)}$("div[id$=_all]").hide();$("#"+c+"_all").show();$("#comment_list .starlevel").removeClass("starlevel").addClass("starlevel");$("#"+c+"_all h3[class=tit]").hide()}}if($(window).scrollTop()>$("#review_point").offset().top){$(this).attr("href","#review_point")}else{$(this).attr("href","javascript:;")}$("#all_tab_div").css({position:"relative"})});$("#comm_num_down").die("click").live("click",function(){$("#comment_tab").click()});var b=Detail.beginshow;Detail.tab();$("#"+b+"_tab").click();Detail.product_id=ddproduct.productid;$("#comment_tab").ddlazyload({func:Detail.loadComment});$("#question_tab").ddlazyload({func:Detail.loadQuestion})},loadComment:function(){var c=new Date().getTime();var b=Detail.beginshow;$.getScript("/comment/js/ebookcomment.js?t="+c,function(){if(b=="comment"){Comment.showtitle=false}var d=iswidth?"true":"false";Comment.callback("product_id="+Detail.product_id,"iswidth="+d)})},loadQuestion:function(){var b=new Date().getTime();$.getScript("/question/js/question.js?t="+b,function(){Question.callback("product_id="+Detail.product_id)})},tab:function(){$("#product_tab a[id$=_tab]").removeClass().addClass("middle");$("#product_tab a[id$=_tab]").first().removeClass("middle");$("#product_tab a[id$=_tab]").last().removeClass("middle")},suitImage:function(e,c,f){var j=new Image();j.src=e.src;var d=j.width;var g=j.height;var b=d/g;if(d>c){d=c;g=c/b}if(g>f){g=f;d=f*b}if(d>0&&g>0){e.width=d;e.height=g}}};var Promotion={init:function(){for(var b in Promotion){var c=Promotion[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},view_time:function(){if(the_s>=0){var b=Math.floor((the_s/3600)/24);var e=Math.floor((the_s-b*24*3600)/3600);var c=Math.floor((the_s-b*24*3600-e*3600)/60);var d=(the_s-e*3600)%60;html="还剩";if(b!=0){html+="<i class='red'>"+b+"</i>天"}if(b!=0||e!=0){html+="<i class='red'>"+e+"</i>小时"}if(b!=0||e!=0||c!=0){html+="<i class='red'>"+c+"</i>分"}if(b==0){html+="<i class='red'>"+d+"</i>秒"}html+="结束";$("#limit_time").html(html);the_s--}else{$("#limit_time").html("已结束");clearInterval(limit_time)}},bind:function(){$("#more_gift").click(function(){var b=$(this);var c=b.text();if(c=="向上收起"){$("#gift_list span:gt(2)").hide();b.html('<span class="icon icon_down"></span>更多赠品')}else{$("#gift_list span:hidden").show();b.html('<span class="icon icon_up"></span>向上收起')}});$(".detail_zhuan").hover(function(){$(this).addClass("detail_zhuan_hover")},function(){$(this).removeClass("detail_zhuan_hover")})}};var ShowAll2hbook="http://used.dangdang.com/shop/prd_list.php?pid=";var pricestockUrl="/pricestock/";var PriceStock={init:function(){for(var b in PriceStock){var c=PriceStock[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},get_gather:function(flag){if($("#gather").html()==""&&$("#gather").css("display")=="none"){var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var url=pricestockUrl+"callback.php?type=getfourselect&product_id="+product_id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);$("#gather").html(data.html);var province=PriceStock.Cookie.Get("province");var city=PriceStock.Cookie.Get("city");var area=PriceStock.Cookie.Get("area");if(province>0&&(city<0||city==undefined)){var id=0;var dataname;if(province==111||province==112||province==131||province==150){switch(province){case"111":id=1;dataname="北京市";PriceStock.Cookie.Set("city",id,"",path="/");break;case"112":id=14;dataname="天津市";PriceStock.Cookie.Set("city",id,"",path="/");break;case"131":id=3;dataname="上海市";PriceStock.Cookie.Set("city",id,"",path="/");break;case"150":id=401;dataname="重庆市";PriceStock.Cookie.Set("city",id,"",path="/");break}city=id;$("#cityname").html(dataname);$("#city_top").addClass(" disabled");$("#city_info > ul").html('<li><a id="select_new_city_'+id+'" class="active" href="javascript:;">'+dataname+"</a></li>")}else{$("#area_top").addClass(" disabled")}}if(flag=="error_box"){if(province<0||province==undefined){$("#province_top").addClass(" error_box")}else{if(province>0&&(city<0||city==undefined)){$("#city_top").addClass(" error_box")}}if(province>0&&city>0&&(area<0||area==undefined)){$("#area_top").addClass(" error_box")}}if((province==undefined||province=="-1")&&(city==undefined||city=="-1")&&(area==undefined||area=="-1")){$("#city_top").addClass(" disabled");$("#area_top").addClass(" disabled")}$("#block_top").hide();var citynamhtml=$("#cityname").html();var area_name=$("#areaname").html();var have_chile=$("#cityname").attr("have_chile");if(have_chile=="0"){if(citynamhtml=="请选择市"){$("#areaname").html(area_name)}else{$("#areaname").html(citynamhtml)}$("#area_top").removeClass(" error_box");$("#area_info > ul").html('<li><a id="select_new_city_'+city+'" class="active" href="javascript:;">'+citynamhtml+"</a></li>")}if(citynamhtml=="北京市"||citynamhtml=="天津市"||citynamhtml=="上海市"||citynamhtml=="重庆市"||citynamhtml=="上海市"||citynamhtml=="香港特别行政区"||citynamhtml=="澳门特别行政区"){$("#city_top").addClass(" disabled")}$("#gather").show();if($("#areaname").width()>163){$("#areaname").attr("style","width:163px;")}else{$("#areaname").attr("style","")}}})}else{$("#block_top").hide();if(flag=="error_box"){var provinceIndex=0;var cityIndex=0;var areaIndex=0;if($("#provincename").html()!=null){provinceIndex=$("#provincename").html().indexOf("请选择")}if($("#cityname").html()!=null){cityIndex=$("#cityname").html().indexOf("请选择")}if($("#areaname").html()!=null){areaIndex=$("#areaname").html().indexOf("请选择")}if(provinceIndex>-1){$("#province_top").addClass("error_box")}else{if(cityIndex>-1){$("#city_top").addClass("error_box").removeClass("disabled")}else{if(areaIndex>-1){$("#area_top").addClass("error_box").removeClass("disabled")}}}if(provinceIndex<0){$("#province_top").removeClass("error_box")}else{if(cityIndex<0){$("#city_top").removeClass("error_box").removeClass("disabled")}else{if(areaIndex<0){$("#area_top").removeClass("error_box").removeClass("disabled")}}}}$("#gather").show()}},get_province_info:function(buy){if($("#province_info").html()==""){var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var shop_id=$("#stock_span").attr("shop_id");var url=pricestockUrl+"callback.php?type=getprovincelist&product_id="+product_id+"&shop_id="+shop_id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);$("#province_info").html(data.html);if(buy==true){$("#province_floor").show()}else{$("#province_floor").hide()}$("#city_floor").hide();$("#area_floor").hide()}});if(PriceStock.Cookie.Get("province")>0){$("#select_new_province_"+PriceStock.Cookie.Get("province")).addClass("active")}}else{if(buy==true){$("#province_floor").show()}else{$("#province_floor").hide()}$("#city_floor").hide();$("#area_floor").hide()}},get_city_info:function(buy){if($("#city_info > ul").html()==""){var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var province_obj=$("a.active[id^='select_new_province_']");if(province_obj.attr("id")==undefined&&PriceStock.Cookie.Get("province")<0){return}if(province_obj.attr("id")!=undefined){var province_id=province_obj.attr("id").replace(/select_new_province_/,"")}else{if(PriceStock.Cookie.Get("province")>0){var province_id=PriceStock.Cookie.Get("province")}}if(province_id==undefined){return}var url=pricestockUrl+"callback.php?type=getcitylist&product_id="+product_id+"&province_id="+province_id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);$("#city_info > ul").html(data.html);if($("#city_info > ul > li").length>1){$("#province_floor").hide();if(buy==true){var city_floor_position=$("#city_top").position();$("#city_floor").css({left:(city_floor_position.left+64)});$("#city_floor").show()}else{$("#city_floor").hide()}$("#area_floor").hide()}}})}else{if($("#city_info > ul > li").length>1){$("#province_floor").hide();if(buy==true){var city_floor_position=$("#city_top").position();$("#city_floor").css({left:(city_floor_position.left+64)});$("#city_floor").show()}else{$("#city_floor").hide()}$("#area_floor").hide()}}},getCityList:function(cityId,cityname){var city=cityname;var id=cityId;$("#city_info > ul > li > a").removeClass("active");$("#select_new_city_"+id).addClass("active");var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var url=pricestockUrl+"callback.php?type=getarealist&product_id="+product_id+"&city_id="+id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);if(data.count==0){$("#area_info > ul").html('<li><a id="select_new_city_'+cityId+'" class="active" href="javascript:;">'+cityname+"</a></li>");PriceStock.getOtherAreaStock(city)}else{$("#area_top").removeClass("disabled");$("#area_info > ul").html(data.html);var area_floor_position=$("#area_top").position();$("#area_floor").css({left:(area_floor_position.left-$("#area_floor").width()+$("#area_top").width()+45)+"px"});$("#area_floor").show()}}})},getOtherAreaStock:function(city){$("#stock_writing_status").removeClass();$("#stock_writing_status").html("");$("#cityname").html(city);$("#city_top").removeClass(" error_box");$("#city_floor").hide();PriceStock.Cookie.Del("area",path="/");PriceStock.Cookie.Del("_area",path="/");PriceStock.Cookie.Set("country",9000,"",path="/");PriceStock.Cookie.Set("_province",9000,"",path="/");var province_obj=$("a.active[id^='select_new_province_']");var province_id=province_obj.attr("id").replace(/select_new_province_/,"");PriceStock.Cookie.Set("province",province_id,"",path="/");var city_obj=$("a.active[id^='select_new_city_']");var city_id=city_obj.attr("id").replace(/select_new_city_/,"");PriceStock.Cookie.Set("city",city_id,"",path="/");PriceStock.Cookie.Set("_city",province_id,"",path="/");var province_name=$("#select_new_province_"+province_id+"").html();if(province_name=="香港"||province_name=="澳门"){province_name=""}var city_name=$("#select_new_city_"+city_id+"").html();$("#select_add_span").html(province_name+""+city_name+'<i class="kc_choose"></i>');$("#callback_all_area").html(province_name+""+city_name+'<i class="kc_choose"></i>');var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var url=pricestockUrl+"callback.php?type=stock&product_id="+product_id+"&gift_ids=&gift_counts=&fourarea=true&province_id="+province_id+"&city_id="+city_id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);if(data.pre_arrival_date){$("#pre_arrival_date").empty().html("预计到达时间"+data.pre_arrival_date)}else{$("#pre_arrival_date").empty()}if(data.havestock==true||data.havestock=="realstock"){$("#stock_writing_status").addClass("store");$("#stock_writing_status").html("有货");$("#part_buy_button").attr("name","__Shopcar_pub");var area_id=undefined;PriceStock.getarriveDate(product_id,city_id,area_id)}else{if(data.havestock=="presale"){$("#stock_writing_status").addClass("booking ckph");$("#stock_writing_status").html("可预订");$("#arr_time").hide();$("#part_buy_button").attr("name","__Reservation")}else{if(data.havestock=="nostock"||data.havestock==false){$("#stock_writing_status").addClass("qh ckph");$("#stock_writing_status").html("缺货");$("#pre_arrival_date").empty();$("#arr_time").hide();$("#part_buy_button").attr("name","__Shopcar_pub")}}}$("#stock_status").attr("true_value",data.stock_status);$("#stock_status").val(data.stock_status_value);if($("#prd_span").attr("pre_sale")==1&&(data.status==2||data.status==1)){if(data.havestock==true||data.havestock=="realstock"){var buy_button="btn btn_buy";if($("#prd_span").attr("is_direct_buy")==1){var buy_button="btn btn_paynow"}var part_buy_button="btn btn_buy";if($("#prd_span").attr("is_direct_buy")==1){var part_buy_button="btn btn_buy"}if($("#prd_span").attr("stock_status")==2){var url=pricestockUrl+"callback.php?type=getstocktipvalue&product_id="+product_id+"&t="+Math.random();$.get(url,function(data){if(data!=""){$("#dp_presell").html("");$("#newpresale").html('<a href="javascript:void(0);" class="'+part_buy_button+'" onclick="Operation.doAddToShoppingCart('+$("#prd_span").attr("name")+","+$("#prd_span").attr("is_direct_buy")+","+$("#prd_span").attr("shippingfee")+',this);" id="part_buy_button" param="'+data+"#"+$("#pid_span").attr("name")+'" name="__Shopcar_pub"></a>')}})}else{$("#dp_presell").html("");$("#newpresale").html('<a href="javascript:;" class="'+buy_button+'" onclick="Operation.doAddToShoppingCart('+$("#prd_span").attr("name")+","+$("#prd_span").attr("is_direct_buy")+","+$("#prd_span").attr("shippingfee")+',this);" title="购买" id="part_buy_button" name="__Shopcar_pub"></a>')}}else{if(data.havestock=="nostock"||data.havestock=="presale"||data.havestock==false){if(data.havestock=="presale"){var pre_arrival_date=$("#prd_span").attr("pre_arrival_date");if(pre_arrival_date&&pre_arrival_date!=undefined){$("#dp_presell").html(pre_arrival_date)}$("#stock_status").attr("value",1);$("#newpresale").html('<a href="javascript:;" class="btn btn_booking" onclick="Operation.doAddToShoppingCart( '+$("#prd_span").attr("name")+" ,"+$("#prd_span").attr("is_direct_buy")+","+$("#prd_span").attr("shippingfee")+' ,this);" title="预订" id="part_buy_button" name="__Reservation"></a>')}else{$("#dp_presell").html("");$("#part_buy_button").removeClass().addClass("btn btn_buy btn_buy_no");$("#part_buy_button").attr("name","__Shopcar_pub")}}}}else{if(data.nobuy!=""){if(data.havestock!="presale"){$("#part_buy_button").removeClass().addClass("btn btn_buy btn_buy_no");$("#part_buy_button").attr("name","__Shopcar_pub")}else{$("#part_buy_button").removeClass().addClass("btn btn_booking");$("#part_buy_button").attr("name","__Reservation")}}else{if(data.is_direct_buy==1){if(data.havestock!="presale"){$("#part_buy_button").removeClass().addClass("btn btn_paynow");$("#part_buy_button").attr("name","__Shopcar_pub")}else{$("#part_buy_button").removeClass().addClass("btn btn_booking");$("#part_buy_button").attr("name","__Reservation")}}else{if(data.havestock!="presale"){$("#part_buy_button").removeClass().addClass("btn btn_buy");$("#part_buy_button").attr("name","__Shopcar_pub")}else{$("#part_buy_button").removeClass().addClass("btn btn_booking");$("#part_buy_button").attr("name","__Reservation")}}}}}});$("#area_floor").hide();$("#gather").hide();$("#block_top").show()},publishbang:function(){var c=$("#pid_span").attr("product_id");var b=pricestockUrl+"callback.php?type=getpublishbang&product_id="+c+"&t="+Math.random();$.get(b,function(d){if(d!=""){$("#pubbang").html(d);$("#pubbang").show()}})},getarriveDate:function(e,d,c){if(c!=undefined){d=c}var b=pricestockUrl+"callback.php?type=arrivedate&product_id="+e+"&city_id="+d+"&t="+Math.random();$.get(b,function(f){if(f!=""){$("#arr_time").html(f);$("#arr_time").show()}else{$("#arr_time").hide()}})},bind:function(){PriceStock.publishbang();if($("#priceclass").length>0){var priceclass=$("#priceclass").attr("value");if(priceclass!=""||priceclass!=undefined){$("#d_price").addClass(priceclass)}}var isIn=function(tar,parent){while(tar!=null&&typeof(tar.tagName)!="undefind "){if(tar.outerHTML==parent.outerHTML){return true}tar=tar.parentElement}return false};var ids=new Array("select_add_span","gather","province_floor","city_floor","area_floor","part_buy_button");document.onclick=function(e){if($("#gather").length>0&&$("#gather")[0].style.display!="none"){var e=e?e:window.event;var tar=e.srcElement||e.target;var is_in=false;for(i in ids){if($("#"+ids[i])[0]){if(isIn(tar,$("#"+ids[i])[0])){is_in=true;break}}}if(!is_in){$("#province_floor").hide();$("#city_floor").hide();$("#area_floor").hide();$("#gather").hide();$("#block_top").show()}}};$("#show_all_2hbook").click(function(){if($("#MsgBoxFrame1").attr("id")!=undefined){win_top=$(this).position().top;win_left=($("body").width()-838)/2;$("#MsgBoxFrame1").css({top:win_top,left:win_left});$("#MsgBoxFrame1").show()}else{html="<iframe id=MsgBoxFrame1 name=MsgBoxFrame1  src='' frameborder=0 width='806px' scrolling=no style='display:none;position:absolute;z-index:19999;'></iframe>";$("body").append(html);pid=$("#pid_span").attr("name");url=ShowAll2hbook+pid;$("#MsgBoxFrame1").attr("src",url+"&t="+Math.random());win_top=$(this).position().top;win_left=($("body").width()-838)/2;$("#MsgBoxFrame1").css({top:win_top,left:win_left});$("#MsgBoxFrame1").show()}return false});$("#select_add").live("click",function(){PriceStock.get_gather()});$("#province_top").live("click",function(){PriceStock.get_province_info(true)});$("#city_top").live("click",function(){PriceStock.get_city_info(true)});$("#area_top").live("click",function(){if($(this).attr("class").indexOf("disabled")>-1){return}if($("#area_info > ul").html()==""){var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var city_obj=$("a.active[id^='select_new_city_']");if(city_obj.attr("id")==undefined&&PriceStock.Cookie.Get("city")<0&&$("#area_info > ul").html()==""){return}if($("#cityname").html()=="香港特别行政区"||$("#cityname").html()=="澳门特别行政区"){return}if(city_obj.attr("id")!=undefined){var city_id=city_obj.attr("id").replace(/select_new_city_/,"")}else{if(PriceStock.Cookie.Get("city")>0){var city_id=PriceStock.Cookie.Get("city")}}var url=pricestockUrl+"callback.php?type=getarealist&product_id="+product_id+"&city_id="+city_id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);if(data.count>0){$("#area_info > ul").html(data.html);$("#province_floor").hide();$("#city_floor").hide();var area_floor_position=$("#area_top").position();$("#area_floor").css({left:(area_floor_position.left-$("#area_floor").width()+$("#area_top").width()+45)+"px"});$("#area_floor").show()}}})}else{$("#province_floor").hide();$("#city_floor").hide();var area_floor_position=$("#area_top").position();$("#area_floor").css({left:(area_floor_position.left-$("#area_floor").width()+$("#area_top").width()+45)+"px"});$("#area_floor").show()}});var fourareajson={ALL:{"111":"\u5317\u4eac","112":"\u5929\u6d25","113":"\u6cb3\u5317","114":"\u5c71\u897f","115":"\u5185\u8499\u53e4","121":"\u8fbd\u5b81","122":"\u5409\u6797","123":"\u9ed1\u9f99\u6c5f","131":"\u4e0a\u6d77","132":"\u6c5f\u82cf","133":"\u6d59\u6c5f","134":"\u5b89\u5fbd","135":"\u798f\u5efa","136":"\u6c5f\u897f","137":"\u5c71\u4e1c","141":"\u6cb3\u5357","142":"\u6e56\u5317","143":"\u6e56\u5357","144":"\u5e7f\u4e1c","145":"\u5e7f\u897f","146":"\u6d77\u5357","150":"\u91cd\u5e86","151":"\u56db\u5ddd","152":"\u8d35\u5dde","153":"\u4e91\u5357","154":"\u897f\u85cf","161":"\u9655\u897f","162":"\u7518\u8083","163":"\u9752\u6d77","164":"\u5b81\u590f","165":"\u65b0\u7586","171":"\u53f0\u6e7e","172":"\u9999\u6e2f","173":"\u6fb3\u95e8"},AG:{"134":"\u5b89\u5fbd","173":"\u6fb3\u95e8","111":"\u5317\u4eac","150":"\u91cd\u5e86","135":"\u798f\u5efa","144":"\u5e7f\u4e1c","162":"\u7518\u8083","145":"\u5e7f\u897f","152":"\u8d35\u5dde"},HN:{"113":"\u6cb3\u5317","123":"\u9ed1\u9f99\u6c5f","141":"\u6cb3\u5357","142":"\u6e56\u5317","143":"\u6e56\u5357","146":"\u6d77\u5357","122":"\u5409\u6797","132":"\u6c5f\u82cf","136":"\u6c5f\u897f","121":"\u8fbd\u5b81","115":"\u5185\u8499\u53e4","164":"\u5b81\u590f"},OT:{"163":"\u9752\u6d77","161":"\u9655\u897f","114":"\u5c71\u897f","131":"\u4e0a\u6d77","137":"\u5c71\u4e1c","151":"\u56db\u5ddd","112":"\u5929\u6d25","171":"\u53f0\u6e7e"},UZ:{"165":"\u65b0\u7586","172":"\u9999\u6e2f","154":"\u897f\u85cf","153":"\u4e91\u5357","133":"\u6d59\u6c5f"}};$("a[id^='bw_']").live("click",function(){var old_word=PriceStock.Cookie.Get("old_province_word");var obj=$(this);var word=obj.attr("id").replace(/bw_/,"");if(word!=old_word){PriceStock.Cookie.Set("old_province_word",word,"",path="/");$("#bw_"+word).addClass("active");$("#bw_"+old_word).removeClass("active")}var area=eval("fourareajson."+word+";");var html="";var old_province=PriceStock.Cookie.Get("province");for(var i in area){if(old_province==i){var selectclass="active"}else{var selectclass=""}html+='<li><a id="select_new_province_'+i+'" class="'+selectclass+'" href="javascript:;">'+area[i]+"</a></li>"}$("#province_info > ul").html(html)});$("#address_close").live("click",function(){$("#address").hide()});$("a[id^='select_new_province_']").live("click",function(){$("#areaname").attr("style","");$("#areaname").html("请选择区");$("#area_top").addClass("disabled").removeClass("error_box");$("#area_info > ul").html("");$("#city_top").removeClass(" disabled").removeClass("error_box");var obj=$(this);var id=obj.attr("id").replace(/select_new_province_/,"");var province=obj.text();$("#province_info > ul > li > a").removeClass("active");$("#select_new_province_"+id).addClass("active");$("#provincename").html(province);$("#province_top").removeClass(" error_box");var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var url=pricestockUrl+"callback.php?type=getcitylist&product_id="+product_id+"&province_id="+id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);$("#city_info > ul").html(data.html);if(parseInt(data.count)>1){$("#cityname").html("请选择市");$("#province_floor").hide();var city_floor_position=$("#city_top").position();$("#city_floor").css({left:(city_floor_position.left+64)});$("#city_floor").show();$("#area_floor").hide()}if(parseInt(data.count)==1){$("#city_top").addClass(" disabled");$("#city_info > ul").html(data.city_name);$("#cityname").html(data.name);if(data.name!="北京市"&&data.name!="天津市"&&data.name!="上海市"&&data.name!="重庆市"&&data.name!="上海市"){$("#area_top").removeClass(" disabled");$("#areaname").html(data.name)}$("#city_top").removeClass(" error_box");$("#city_floor").hide();$("#province_floor").hide();$("#area_floor").hide();PriceStock.getCityList(data.city_id,data.name)}}})});$("a[id^='select_new_city_']").live("click",function(){$("#areaname").attr("style","");var obj=$(this);var city=obj.text();var id=obj.attr("id").replace(/select_new_city_/,"");$("#city_info > ul > li > a").removeClass("active");$("#select_new_city_"+id).addClass("active");var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var url=pricestockUrl+"callback.php?type=getarealist&product_id="+product_id+"&city_id="+id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);if(data.count==0){$("#areaname").html(city);$("#area_top").removeClass(" error_box");$("#area_top").removeClass("disabled");$("#area_info > ul").html('<li><a id="select_new_city_'+id+'" class="active" href="javascript:;">'+city+"</a></li>");PriceStock.getOtherAreaStock(city)}else{$("#areaname").html("请选择区");$("#area_top").removeClass("disabled").removeClass("error_box");$("#cityname").html(city);$("#city_top").removeClass(" error_box");$("#area_info > ul").html(data.html);var area_floor_position=$("#area_top").position();$("#area_floor").css({left:(area_floor_position.left-$("#area_floor").width()+$("#area_top").width()+45)+"px"});$("#area_floor").show();$("#province_floor").hide();$("#city_floor").hide()}}})});$("a[id^='select_new_area_']").live("click",function(){$("#stock_writing_status").removeClass();$("#stock_writing_status").html("");$("#pre_arrival_date").html("");var obj=$(this);var area=obj.text();var id=obj.attr("id").replace(/select_new_area_/,"");PriceStock.Cookie.Set("country",9000,"",path="/");PriceStock.Cookie.Set("_province",9000,"",path="/");var province_obj=$("a.active[id^='select_new_province_']");if(province_obj.attr("id")!=undefined){var province_id=province_obj.attr("id").replace(/select_new_province_/,"")}else{var province_id=PriceStock.Cookie.Get("province")}PriceStock.Cookie.Set("province",province_id,"",path="/");var city_obj=$("a.active[id^='select_new_city_']");if(city_obj.attr("id")!=undefined){var city_id=city_obj.attr("id").replace(/select_new_city_/,"")}else{if(PriceStock.Cookie.Get("city")>0){var city_id=PriceStock.Cookie.Get("city")}}PriceStock.Cookie.Set("city",city_id,"",path="/");PriceStock.Cookie.Set("_city",province_id,"",path="/");PriceStock.Cookie.Set("area",id,"",path="/");PriceStock.Cookie.Set("_area",city_id,"",path="/");$("#areaname").html(area);$("#area_top").removeClass(" error_box");if($("#select_new_area_"+id).width()>163){$("#areaname").attr("style","width:163px;")}else{$("#areaname").attr("style","")}var province_name=$("#select_new_province_"+province_id+"").html();if(!province_name){province_name=$("#provincename").html()}var city_name=$("#select_new_city_"+city_id+"").html();if(!city_name){city_name=$("#cityname").html()}var area_name=$("#select_new_area_"+id+"").html();if($("#city_info > ul > li").length==1||province_name=="北京"||province_name=="天津"||province_name=="上海"||province_name=="重庆"||province_name=="上海"){$("#select_add_span").html(city_name+""+area_name+'<i class="kc_choose"></i>');$("#callback_all_area").html(city_name+""+area_name+'<i class="kc_choose"></i>')}else{$("#select_add_span").html(province_name+""+city_name+""+area_name+'<i class="kc_choose"></i>');$("#callback_all_area").html(province_name+""+city_name+""+area_name+'<i class="kc_choose"></i>')}$("#area_info > ul > li > a").removeClass("active");$("#select_new_area_"+id).addClass("active");var product_id=$("#stock_span").attr("prd_id");var page_type=$("#stock_span").attr("page_type");var url=pricestockUrl+"callback.php?type=stock&product_id="+product_id+"&gift_ids=&gift_counts=&fourarea=true&province_id="+province_id+"&city_id="+city_id+"&area_id="+id+"&page_type="+page_type+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);if(data.pre_arrival_date){$("#pre_arrival_date").empty().html("预计到达时间"+data.pre_arrival_date)}else{$("#pre_arrival_date").empty()}if(data.havestock=="presale"){var pre_arrival_date=$("#prd_span").attr("pre_arrival_date");if(pre_arrival_date&&pre_arrival_date!=undefined){$("#dp_presell").empty().html(pre_arrival_date)}}if(data.havestock==true||data.havestock=="realstock"){$("#stock_writing_status").addClass("store");$("#stock_writing_status").html("有货");$("#part_buy_button").attr("name","__Shopcar_pub");PriceStock.getarriveDate(product_id,city_id,id)}else{if(data.havestock=="presale"){$("#stock_writing_status").addClass("booking ckph");$("#stock_writing_status").html("可预订");$("#arr_time").hide();$("#part_buy_button").attr("name","__Reservation")}else{if(data.havestock=="nostock"||data.havestock==false){$("#stock_writing_status").addClass("qh ckph");$("#stock_writing_status").html("缺货");$("#pre_arrival_date").empty();$("#arr_time").hide();$("#part_buy_button").attr("name","__Shopcar_pub")}}}$("#stock_status").attr("true_value",data.stock_status);$("#stock_status").val(data.stock_status_value);if($("#prd_span").attr("pre_sale")==1&&(data.status==2||data.status==1)){if(data.havestock==true||data.havestock=="realstock"){var buy_button="btn btn_buy";if($("#prd_span").attr("is_direct_buy")==1){var buy_button="btn btn_paynow"}var part_buy_button="btn btn_buy";if($("#prd_span").attr("is_direct_buy")==1){var part_buy_button="btn btn_paynow"}if($("#prd_span").attr("stock_status")==2){var url=pricestockUrl+"callback.php?type=getstocktipvalue&product_id="+product_id+"&t="+Math.random();$.get(url,function(data){if(data!=""){$("#dp_presell").html("");$("#newpresale").html('<a href="javascript:void(0);" class="'+part_buy_button+'" onclick="Operation.doAddToShoppingCart('+$("#prd_span").attr("name")+","+$("#prd_span").attr("is_direct_buy")+","+$("#prd_span").attr("shippingfee")+',this);" id="part_buy_button" param="'+data+"#"+$("#pid_span").attr("name")+'" name="__Shopcar_pub"></a>')}})}else{$("#dp_presell").html("");$("#newpresale").html('<a href="javascript:;" class="'+buy_button+'" onclick="Operation.doAddToShoppingCart('+$("#prd_span").attr("name")+","+$("#prd_span").attr("is_direct_buy")+","+$("#prd_span").attr("shippingfee")+',this);" title="购买" id="part_buy_button" name="__Shopcar_pub"></a>')}}else{if(data.havestock=="nostock"||data.havestock=="presale"||data.havestock==false){if(data.havestock=="presale"){var pre_arrival_date=$("#prd_span").attr("pre_arrival_date");if(pre_arrival_date&&pre_arrival_date!=undefined){$("#dp_presell").html(pre_arrival_date);$("#dp_presell").parent("span").show()}$("#stock_status").attr("value",1);$("#newpresale").html('<a href="javascript:;" class="btn btn_booking" onclick="Operation.doAddToShoppingCart( '+$("#prd_span").attr("name")+" ,"+$("#prd_span").attr("is_direct_buy")+","+$("#prd_span").attr("shippingfee")+' ,this);" title="预订" id="part_buy_button" name="__Reservation"></a>')}else{$("#dp_presell").html("");$("#part_buy_button").removeClass().addClass("btn btn_buy btn_buy_no");$("#part_buy_button").attr("name","__Shopcar_pub")}}}}else{if(data.nobuy!=""){if(data.havestock!="presale"){$("#part_buy_button").removeClass().addClass("btn btn_buy btn_buy_no");$("#part_buy_button").attr("name","__Shopcar_pub")}else{$("#part_buy_button").removeClass().addClass("btn btn_booking");$("#part_buy_button").attr("name","__Reservation")}}else{if(data.is_direct_buy==1){if(data.havestock!="presale"){$("#part_buy_button").removeClass().addClass("btn btn_paynow");$("#part_buy_button").attr("name","__Shopcar_pub")}else{$("#part_buy_button").removeClass().addClass("btn btn_booking");$("#part_buy_button").attr("name","__Reservation")}}else{if(data.havestock!="presale"){$("#part_buy_button").removeClass().addClass("btn btn_buy");$("#part_buy_button").attr("name","__Shopcar_pub")}else{$("#part_buy_button").removeClass().addClass("btn btn_booking");$("#part_buy_button").attr("name","__Reservation")}}}}}});$("#area_floor").hide();$("#gather").hide();$("#block_top").show()});$("#comm_num_down").die("click").live("click",function(){Detail.beginshow="comment"});$("#present_box > a").mousemove(function(){$("#present_box > span").show()}).mouseout(function(){$("#present_box > span").hide()})}};PriceStock.Cookie={Get:function(d){var c=document.cookie.split("; ");var e=[],b;for(i=0;i<c.length;i++){b=c[i].split("=");e[b[0]]=unescape(b[1])}if(d){return e[d]}else{return e}},Set:function(e,g,b,j,f,h){if(!e||!g){return false}if(e==""||g==""){return false}var d=new Date();if(b){if(/^[0-9]+$/.test(b)){b=new Date(d.getTime()+b*1000).toGMTString()}else{if(!/^wed, d{2} w{3} d{4} d{2}:d{2}:d{2} GMT$/.test(b)){b=undefined}}}else{b=new Date(d.getTime()+3600000*24*365).toGMTString()}var c=e+"="+escape(g)+";"+((b)?" expires="+b+";":"")+((j)?"path="+j+";":"")+((f)?"domain="+f+";":"")+((h&&h!=0)?"secure":"");if(c.length<4096){document.cookie=c;return true}else{return false}},Del:function(b,d,c){if(!b){return false}if(b==""){return false}if(!this.Get(b)){return false}document.cookie=b+"=;"+((d)?"path="+d+";":"")+((c)?"domain="+c+";":"")+"expires=Thu, 01-Jan-1970 00:00:01 GMT;";return true}};var CheckoutUrl="http://checkout.dangdang.com/dbuy/checkout_dbuy.aspx?product_id=";var AddFavorlist="http://customer.dangdang.com/wishlist/remote_addtofavorlist.aspx";var abtestUrl="http://shopping.dangdang.com/shoppingcart/cart_init.php?product_ids=";var operationUrl="/operation/";var stock_all_havestock_buy=true;var contractUrl="/contractphone/product.php?product_id=";var abtestNewUrl="http://shopping.dangdang.com/shoppingcart/cart_init_new.php?product_ids=";var Operation={init:function(){for(var b in Operation){var c=Operation[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},doAddToShoppingCart:function(h,k,m,j,n){var e=parseInt($("#buy_num").val());var l;if($("#stock_status").val()==undefined){l=1}else{var o=$("#stock_status").val();if(o==""){l=2}else{if(o!=0){l=1}else{l=0}}}if(l==2){$("#stock_html_top_div").addClass("location_wrap_error")}else{if(l==0){$("#stock_html_top_div").addClass("location_wrap_error")}else{var g=$("#prd_span").attr("status");var o=$("#prd_span").attr("stock_status");if(g==2||o==2){if(stock_all_havestock_buy){var d=PriceStock.Cookie.Get("province");var f=PriceStock.Cookie.Get("city");var b=PriceStock.Cookie.Get("area");if(d==undefined){return}if(d==undefined&&f==undefined){return}if(b==undefined&&d==undefined&&f==undefined){return}if($("#select_add_span").html()==null){return}}else{$("#select_add_span").html('请选择配送地区<i class="kc_choose">&nbsp;</i>')}}if(k){html='<div class="popup w298" style="margin-top:10px;" id="direct_buy_win" style=""><input type="hidden" id="item_id" value="'+h+'"/><h4><a href="javascript:void(0);" id="direct_buy_win_close" class="icon icon_close"></a>确认购买信息</h4><div class="content center"><p>此商品需要单独配送';if(m>0){html+='，每件收取<i class="red">&yen;'+m+"</i>运费"}html+='</p><a href="javascript:void(0);" class="btn btn_know" id="direct_buy_button"></a></div></div>';if($("direct_buy_win").attr("id")==undefined){$("body").append(html)}offset=$(j).offset();win_top=offset.top-10;win_left=offset.left-20;$("#direct_buy_win").css({top:win_top,left:win_left,position:"absolute","z-index":999})}else{var c="http://product.dangdang.com/product.aspx?product_id="+h;if($("#buy_num").attr("id")!=undefined){if(!n){n={x:0,y:0}}if(Operation.checkBuyNum($("#buy_num"))){$.get(operationUrl+"callback.php",{type:"abtest",t:Math.random()},function(p){if(p=="a"){DDCART.ADDCartWin(h+"."+$.trim(e),j,n,{dd_refer:c})}else{if(p=="b"){window.location.href=abtestUrl+h+"."+$.trim(e)+"#"+c;return false}else{if(p=="c"){window.location.href=abtestNewUrl+h+"."+$.trim(e)+"#"+c;return false}}}})}}else{if(!n){n={x:0,y:0}}DDCART.ADDCartWin(h,j,n,{dd_refer:c})}}}}},checkBuyNum:function(e){var d=parseInt(e.val());var b=parseInt($("#buy_num_text").attr("buy_num"));var c=parseInt($("#buy_num_text").attr("olbn"));var g=parseInt($("#buy_num_text").attr("plbn"));var f=0;if($("#limit_max_num").attr("id")!=undefined){f=$("#limit_max_num").attr("value")}else{if(g>0){f=g}}if(isNaN(d)||d<=0){$("#buy_num_text").html('<i class="red">请输入购买数量</i>');$("#buy_num_text").show();$("#stock_alarm").hide();$("#buy_num_count_text").hide();return false}else{if(f>0&&d>f){$("#buy_num_text").html('每账户最多可购买<i class="red">'+f+"</i>件");$("#buy_num_text").show();$("#stock_alarm").hide();$("#buy_num_count_text").hide();return false}else{if(d<b){$("#buy_num_text").html('此商品<i class="red">'+b+"</i>件起购");$("#buy_num_text").show();$("#stock_alarm").hide();$("#buy_num_count_text").hide();return false}else{if(c>0&&d>c&&f<=0){$("#buy_num_text").html('本商品限购<i class="red">'+c+"</i>件");$("#buy_num_text").show();$("#stock_alarm").hide();$("#buy_num_count_text").hide();return false}else{$("#buy_num_text").hide();return true}}}}},bind:function(){$("#direct_buy_win_close").livequery("click",function(){$("#direct_buy_win").remove()});$("#direct_buy_button").livequery("click",function(){var f=$("#prd_span").attr("name");var g=$("#prd_span").attr("iscatalog");if(g){f=$("#item_id").val()}var d=parseInt($("#buy_num").val());var e;var c="http://product.dangdang.com/product.aspx?product_id="+f;if($("#buy_num").attr("id")!=undefined){if(Operation.checkBuyNum($("#buy_num"))){e=CheckoutUrl+f+"."+$.trim(d)+"#"+c}}else{e=CheckoutUrl+f+"#"+c}if(e){$("#direct_buy_win").remove();var b=window.open(e,"checkout");b.focus()}});$("#buy_num").keypress(function(b){key_code=b.keyCode?b.keyCode:b.charCode;if(key_code!=0&&(key_code<48||key_code>57)&&key_code!=8&&key_code!=37&&key_code!=39){return false}else{return true}});$("#buy_num").keyup(function(){Operation.checkBuyNum($(this))});$("#collect").click(function(){id=$(this).attr("id");product_id=$(this).attr("prd");showMsgBox(id,product_id,AddFavorlist,Promotion.set_all_price);__dd_trackPageclick();return false});$("#stock_win").livequery("mouseover",function(){$("#part_stock").addClass("hover");$("#stock_win").show()});$("#stock_win").livequery("mouseout",function(){$("#part_stock").removeClass("hover");$("#stock_win").hide()});$("#part_buy_button").live("click",function(){var e=$("#prd_span").attr("iscatalog");var l=$("#stock_status").attr("value");if(e){var k=P_BOX.getSelectedValue().selectValue;if(k==""||l==1){return}}var c=PriceStock.Cookie.Get("province");var g=PriceStock.Cookie.Get("city");var b=PriceStock.Cookie.Get("area");var h=$("#prd_span").attr("status");var l=$("#prd_span").attr("stock_status");if(l==1&&(h==0||h==1)){$("#province_floor").hide();$("#city_floor").hide();$("#area_floor").hide();$("#gather").hide();$("#block_top").show();return}if($("#select_add_span").html()==null){return}if(!$("#select_add_span").html().indexOf("请选择配送地区")>-1){$("#province_floor").hide();$("#city_floor").hide();$("#area_floor").hide();$("#gather").hide();$("#block_top").show()}if($("#select_add_span").html().indexOf("请选择配送地区")>-1){PriceStock.get_gather("error_box");if(c>0){PriceStock.get_province_info(false)}if(g>0){PriceStock.get_city_info(false)}var j=-1;var f=-1;var d=-1;if($("#provincename").html()!=null){j=$("#provincename").html().indexOf("请选择")}if($("#cityname").html()!=null){f=$("#cityname").html().indexOf("请选择")}if($("#areaname").html()!=null){d=$("#areaname").html().indexOf("请选择")}if((c<0||c==undefined)&&j>-1){$("#province_top").addClass(" error_box")}else{if(c>0&&(g<0||g==undefined)&&(f>-1&&j==-1)){$("#city_top").addClass(" error_box")}else{if(c>0&&g>0&&(b<0||b==undefined)&&(j==-1&&f==-1&&d>-1)){$("#area_top").addClass(" error_box")}}}}});if($("#phone_price").length>0){$("#phone_price").live("click",function(){if(Operation.isPostAppMsg){$("#phone_price >div").show();return}showMsgBox("phone_price","","",Operation.OpenAppMsgIframe)});$("#phone_price").mouseout(function(){$("#phone_price >div").hide(5)})}},isPostAppMsg:false,OpenAppMsgIframe:function(){var b=$("#pid_span").attr("product_id");var c=operationUrl+"callback.php?type=post_app_msg&product_id="+b;$("body").append('<script src="'+c+'"><\/script>')},SendAppMsg:function(b){$("#phone_price >div").show();if(!Operation.isPostAppMsg){$("body").append('<script src="'+b+'"><\/script>');Operation.isPostAppMsg=true}},showQR:function(){var b=$("#phone_buy_pop").width();var g=$("#phone_buy_pop").height();var d=$("#phone_buy_button").width();var c=$("#phone_buy_button").height();var f=$("#phone_buy_button").offset();var l=f.left;var j=f.top;var h=$(window).scrollLeft();var k=$(window).scrollTop();var e=0;var m=l;if((j-k)>g){e=j-g-25}else{e=j+c+2}$("#phone_buy_pop").css({"z-index":10001,position:"absolute",top:e+"px",left:m+"px"}).show();$("#phone_buy_pop").show()},hideQR:function(){$("#phone_buy_pop").hide()}};Operation.myCycle={start:function(c,b){c.ddcycle(b)},pause:function(b){b.ddcycle("pause")},resume:function(b){b.ddcycle("resume")},stop:function(b){b.ddcycle("stop")}};Operation.promo28={init:function(){Operation.promo28.bind_open();Operation.promo28.bind_cycle()},bind_open:function(){var b=$(".hide");b.each(function(){var c=$(this);var e=c.attr("id").replace(/hg_zk_/,"");var d=$("#hg_gift_"+e);c.click(function(){var f=$(this).text();if(f=="详细"){c.html('<span class="icon icon_up"></span>收起');d.show()}else{c.html('<span class="icon icon_down"></span>详细');d.hide()}})})},bind_cycle:function(){$("ul[id^='hg_cycle_']").each(function(){var b=$(this);var c=b.attr("id").replace(/hg_cycle_/,"");Operation.myCycle.start(b,{fx:"scrollHorz",timeout:0,speed:500,next:"#hg_next_"+c,prev:"#hg_prev_"+c,prevNextClick:function(d,k,h){var m=$("#hg_count_"+c);var j=h.length;var g=$("#hg_next_"+c);var f=$("#hg_next_n_"+c);var e=$("#hg_prev_"+c);var l=$("#hg_prev_n_"+c);m.text(k+1);if(d&&k==j-1){g.hide();f.show()}else{g.show();f.hide()}if(!d&&k==0){e.hide();l.show()}else{e.show();l.hide()}}})})}};var beforeADDCartWin=function(c,d,e){if($("#part_buy_button").attr("iscatalog")=="true"){var f=P_BOX.getSelectedValue();if(f.selectValue==""){var b='<span class="error">请选择：';if(ItemCount.colorName!=""&&f.colorValue==""){$("#color_size").addClass(" warn_box");b+="“"+ItemCount.colorName+"”"}if(ItemCount.sizeName!=""&&f.sizeValue==""){$("#color_size").addClass(" warn_box");if(ItemCount.colorName!=""&&f.colorValue==""){b+="、"}b+="“"+ItemCount.sizeName+"”"}$("#itemMessage").html(b)}else{c=f.selectValue;DDCART.ADDCartWin(c+".0-"+d,e,{x:-122,y:0},{})}}else{DDCART.ADDCartWin(c+".0-"+d,e,{x:-122,y:0},{})}};var mainimg_max_pic=5;if(iswidth==false){mainimg_max_pic=3}var Mainimg={count:0,init:function(){for(var b in Mainimg){var c=Mainimg[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},callback:function(){var c="";var b=arguments.length;for(var d=0;d<b;d++){c+=arguments[d]+"&"}c=c.substr(0,c.length-1);$.ajax({url:"/mainimg/main.php",data:c,type:"GET",success:function(e){if(e.length>0){$("#mainimg").html(e);Mainimg.bind()}}})},bind:function(){if(iswidth==false){var b=$("ul.pic_list a");b.each(function(){$(this).attr("id",$(this).attr("id").replace("_w","_b"))})}else{}$("ul.pic_list a").mouseover(function(){var e=$(this);if(e.parent("li").attr("class").indexOf("on")<0){var d=$(this).attr("id");$("#largePic").attr("src",d);var c=$("#mainimg_pic").children("ul").children("li.on");c.children("a").attr("href","#");c.removeClass("on");e.parent().addClass("on")}e.removeAttr("href")}).bind("click",function(){$(this).blur();return false});Mainimg.count=$("#mainimg_pic ul").children().length;if(Mainimg.count>mainimg_max_pic){$("#mainimg_pic_next").removeClass("next_none").addClass("next").attr("title","下一张");$("#mainimg_pic").jCarouselLite({visible:mainimg_max_pic,circular:false,btnNext:"#mainimg_pic_next",btnPrev:"#mainimg_pic_pre",afterEnd:Mainimg.toggleBtn})}$("#more_share").die("mouseover").livequery("mouseover",function(){$("#more_share").addClass("share_active");$("#more_share_block").show()});$("#more_share").die("mouseout").livequery("mouseout",function(){$("#more_share").removeClass("share_active");$("#more_share_block").hide()})},toggleBtn:function(b){var c=parseInt(b.children("a").attr("value"));if(c===0){$("#mainimg_pic_pre").removeClass("prev").addClass("prev_none").removeAttr("title")}else{$("#mainimg_pic_pre").removeClass("prev_none").addClass("prev").attr("title","上一张")}if(c+mainimg_max_pic==Mainimg.count){$("#mainimg_pic_next").removeClass("next").addClass("next_none").removeAttr("title")}else{$("#mainimg_pic_next").removeClass("next_none").addClass("next").attr("title","下一张")}},postToWb:function(g,b,e){var k=encodeURI(g);var d=encodeURIComponent(b);var c=encodeURI("5c0f2c9284d44b54b9cf8b246e135407");var f=encodeURI(e);var h="";var j="http://v.t.qq.com/share/share.php?title="+k+"&url="+d+"&appkey="+c+"&site="+h+"&pic="+f;window.open(j,"转播到腾讯微博","width=700, height=680, top=0, left=0, toolbar=no, menubar=no, scrollbars=no, location=yes, resizable=no, status=no")}};var Recommendnew={init:function(){for(var b in Recommendnew){var c=Recommendnew[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},callback:function(){var c="";var b=arguments.length;for(var d=0;d<b;d++){c+=arguments[d]+"&"}c=c.substr(0,c.length-1);$.ajax({url:"/recommendnew/main.php",data:c,type:"GET",cache:false,success:function(e){if(e.length>0){$("#recommendnew").html(e)}}})}};var Newpackageinfo={init:function(){for(var b in Newpackageinfo){var c=Newpackageinfo[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},callback:function(type){var product_id=$("#pid_span").attr("product_id");var promo_id=0;var value=0;var showli=5;if(!iswidth){showli=4}var url="/newpackage/newpackagecallback.php?type=getnewpackage&product_id="+product_id+"&promid="+promo_id+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);if(data.skus!=""){$("#prdsinfo").html(data.skus);$("#npktitle").html(data.title);var counttitle=$("#npktitle").children().length;if(counttitle<1){$("#npktitle").remove()}$("#buys_newpackage").html(data.buydiv);if($("#pkname").attr("value")!=undefined){value=$("#pkname").attr("value")}$("#npkname").attr("value",data.firstid);if(value==0){$("#npkname").addClass("on").show();$("#npk").show()}else{$("#npkname").show()}if(data.count<=showli){$("#newpackage_next").unbind("click").hide();$("#newpackage_prev").unbind("click").hide();if(value==0){$("#npk").show()}Newpackageinfo.bind()}else{if(data.count>showli&&value==0){$("#npk").show();Newpackageinfo.bind();Newpackageinfo.newPackageChang(data.firstid)}}if(value==1){Newpackageinfo.bind()}Newpackageinfo.setVipPrice(data.firstid)}else{if(type==2){$("#packagediv").hide()}$("#npkname").hide();$("#npk").remove()}}else{if(type==2){$("#packagediv").hide()}$("#npkname").hide();$("#npk").remove()}if(data.is_promo_vip=="0"){$("#pvs").parent().hide();if($("#pvs").parent().siblings().length==0){$("#pvs").parent().parent().parent().hide()}}})},newPackageChang:function(e){var d=5;if(!iswidth){d=4}var c=$("#ul_"+e).children().length;var b=$("#div_"+e);$("#newpackage_next").unbind("click");$("#newpackage_prev").unbind("click");if(c>d){$("#newpackage_next").show().removeClass("btn_a next_none").addClass("btn_a next");$("#newpackage_prev").show().removeClass("btn_a prev").addClass("btn_a prev_none");b.jCarouselLite({visible:d,circular:false,btnNext:"#newpackage_next",btnPrev:"#newpackage_prev",afterEnd:Newpackageinfo.newPackageSku})}else{b.css({width:700});$("#ul_"+e).css({width:700});$("#newpackage_next").unbind("click").hide();$("#newpackage_prev").unbind("click").hide()}},newPackageSku:function(c){var f=5;if(!iswidth){f=4}var e=parseInt(c.attr("value"));var b=c.attr("id").replace(/li_/,"");var d=$("#ul_"+b).children().length;if(e===0){$("#newpackage_prev").removeClass("btn_a prev").addClass("btn_a prev_none").removeAttr("title")}else{$("#newpackage_prev").removeClass("btn_a prev_none").addClass("btn_a prev").attr("title","上一个")}if(e+f==d){$("#newpackage_next").removeClass("btn_a next").addClass("btn_a next_none").removeAttr("title")}else{$("#newpackage_next").removeClass("btn_a next_none").addClass("btn_a next").attr("title","下一个")}},doAddToShoppingCart:function(b,d,f,c,e){DDCART.ADDCartWin(b,d,f,{},e)},setVipPrice:function(h){var c=$("#pvs").attr("uvt");var b={vn1:"金卡",vn2:"钻石",vn3:"银卡"};if(c<1){return}var e=b["vn"+c];if(c){var g=new Number($("#npkvipprice"+h).attr("vp"+c));var d=new Number($("#ddprice_"+h).attr("price"));if(g>0){var f=d-g;if(g<1000){g=g.toFixed(2)}if(f<1000){f=f.toFixed(2)}$("#npkvipprice"+h+"> .d_price").html("&yen;"+g);$("#npkvipprice"+h+"> .gray").html("（"+e+"）");$("#npkvipprice"+h).show();$("#npkprice_"+h).hide();$("#save_"+h).html("节省：<i>&yen;"+f+"</i>");$("#ddprice_"+h+"> i").css({"text-decoration":"line-through"})}}if($("#npkvipprice"+h).attr("vp1")==0){$("#pvs").parent().hide();if($("#pvs").parent().siblings().length==0){$("#pvs").parent().parent().parent().hide()}}},bind:function(){$("a[id^='npk_']").live("click",function(){var b=$(this);var c=b.attr("id").replace(/npk_/,"");$("a[id^='npk_']").removeClass("on");$("a[id^='npk_'] >span").hide();$("#prdsinfo > div[id!='div_"+c+"']").hide();$("#buys_newpackage > div[id!='buy_div_"+c+"']").hide();$("#npk_"+c).addClass("on");$("#npk_"+c+" >span").show();$("#div_"+c).show();$("#ul_"+c).show();$("#buy_div_"+c).show();Newpackageinfo.newPackageChang(c);Newpackageinfo.setVipPrice(c)});$("a[id^='buynpk']").live("click",function(){var c=$(this);var d=c.attr("id").replace(/buynpk_/,"");var b=$("#buy_div_"+d).attr("value");Newpackageinfo.doAddToShoppingCart(b,this,{x:-210,y:-200},{},d)});$("#npkname").live("click",function(){var d=$(this);d.addClass("on");$("#npkname").attr("flag",1);var c=d.attr("value");$("a[id^='npk_']").removeClass("on");$("a[id^='npk_'] >span").hide();$("#prdsinfo > div[id!='div_"+c+"']").hide();$("#buys_newpackage > div[id!='buy_div_"+c+"']").hide();$("#npk_"+c).addClass("on");$("#npk").show();$("#npk_"+c+" >span").show();$("#div_"+c).show();$("#ul_"+c).show();$("#buy_div_"+c).show();Newpackageinfo.newPackageChang(c);var b=0;if($("#pkname").attr("value")!=undefined||$("#pkname").attr("value")!=0){b=$("#pkname").attr("value")}if(b!=0){$("#pkname").removeClass("on");$("#pk").hide();$("#package_error").hide()}})}};var Packagetab={init:function(){for(var b in Packagetab){var c=Packagetab[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},packageJson:"",callback:function(){var product_id=$("#pid_span").attr("product_id");var url="/packagetab/packagetabcallback.php?type=packagetab&product_id="+product_id+"&t="+Math.random();if($("#part_buy_button").attr("id")==undefined){return}$.get(url,function(data){if(data!=""){eval("data="+data);$("#packagediv").html(data.packagetab);if(data.packageflag==3){$("#pkname").addClass("on");$("#pkname").show();Package.init();Package.callback();Newpackageinfo.init();Newpackageinfo.callback(data.packageflag)}if(data.packageflag==1){Package.init();Package.callback()}if(data.packageflag==2){Newpackageinfo.init();Newpackageinfo.callback(data.packageflag)}if(data.packageflag==0){$("#packagediv").hide()}}else{$("#packagediv").hide()}})}};var Package={init:function(){for(var b in Package){var c=Package[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},packageJson:"",callback:function(){var product_id=$("#pid_span").attr("product_id");var papertype="wide";var value=0;var newpackageid=0;if(!iswidth){papertype="narrow"}var url="/package/packagecallback.php?type=package&product_id="+product_id+"&papertype="+papertype+"&t="+Math.random();$.get(url,function(data){if(data!=""){eval("data="+data);$("#buy_package").html(data.buybutton);$("#package_info").html(data.packageul);if($("#npkname").attr("value")!=undefined){value=$("#npkname").attr("flag")}if(typeof Package.packageJson!="object"){eval("Package.packageJson="+data.packagejson)}Package.bind();if(value==0){$("#pkname").attr("value",1);$("#pkname").addClass("on");$("#pkname").show();$("#pk").show()}else{$("#pkname").show()}}else{$("#pkname").hide();$("#pk").hide();newpackageid=$("#npkname").attr("value");if(newpackageid>0){$("#npkname").addClass("on");$("a[id^='npk_']").removeClass("on");$("a[id^='npk_'] >span").hide();$("#prdsinfo > div[id!='div_"+newpackageid+"']").hide();$("#buys_newpackage > div[id!='buy_div_"+newpackageid+"']").hide();$("#npk_"+newpackageid).addClass("on");$("#npk").show();$("#npk_"+newpackageid+" >span").show();$("#div_"+newpackageid).show();$("#ul_"+newpackageid).show();$("#buy_div_"+newpackageid).show();Newpackageinfo.newPackageChang(newpackageid)}else{$("#packagediv").hide()}}})},bind:function(){$("input[type='checkbox'][id^='ck']").click(function(){$("#package_error").hide();pid=$(this).attr("id").replace(/ck/,"");pobj=$("#pr"+pid);if($(this).attr("checked")){pobj.addClass("on");pobj.prev("li").children("span").removeClass("icon_special").addClass("icon_on_special")}else{pobj.removeAttr("class");pobj.prev("li").children("span").removeClass("icon_on_special").addClass("icon_special")}var f=1;var e=Package.packageJson.prod[0].price*100;var d=Package.packageJson.prod[0].oprice*100;var b=Package.packageJson.prod.length;for(var c=0;c<b;c++){if(Package.packageJson.prod[c]){var g=Package.packageJson.prod[c].pid;if($("#ck"+g).attr("checked")){e+=Package.packageJson.prod[c].price*100;d+=Package.packageJson.prod[c].oprice*100;f++}}}if(f<=1){$("#package_error").show();$("#ck"+pid).attr("checked",true);$("#pr"+pid).addClass("on");pobj.prev("li").children("span").removeClass("icon_special").addClass("icon_on_special")}else{e=e/100;d=d/100;$("#packCount").html(f);if(d<1000){$("#sumopriceDiv").html("&yen;"+d.toFixed(2))}else{$("#sumopriceDiv").html("&yen;"+d)}if(e<1000){$("#sumpriceDiv").html("&yen;"+e.toFixed(2))}else{$("#sumpriceDiv").html("&yen;"+e)}}$(this).blur()});$("#buy_package_button").click(function(){var k=parseInt($("#buy_num_text").attr("buy_num"));var e=false;var g=Package.packageJson.prod[0].pid+"."+k;var f=Package.packageJson.prod[0].pid;var j=Package.packageJson.prod.length;var l=0;for(var h=0;h<j;h++){if(Package.packageJson.prod[h]){var c=Package.packageJson.prod[h].pid;if($("#ck"+c).attr("checked")){g+=","+c;e=true;f+=","+c;l+=Package.packageJson.prod[h].iscatalog}}}var b="package/packagecatalog.php?product_ids=";if(l){window.open(b+f+"&product_id="+Package.packageJson.prod[0].pid+"&t="+Math.random(),"_blank");return}var d="http://product.dangdang.com/product.aspx?product_id="+Package.packageJson.prod[0].pid+"#ddclick_reco_reco_buytogether";if(!e){$("#package_error").show()}else{DDCART.ADDCartWin(g,this,{x:-186,y:0},{dd_refer:d})}});$("#pkname").live("click",function(){var c=$(this);var b=0;if($("#npkname").attr("value")!=undefined||$("#npkname").attr("value")!=0){b=$("#npkname").attr("value")}if(b!=0){$("#npkname").removeClass("on");$("#npk").hide()}c.addClass("on");$("#pk").show()})},doAddToShoppingCart:function(b,d,e,c){DDCART.ADDCartWin(b,d,e,{})}};var Title={init:function(){for(var b in Title){var c=Title[b];if(typeof c=="object"&&typeof c.init!="undefined"){c.init()}}},bind:function(){$("#phone_buy").hover(function(){$(this).addClass("phone_only_hover")},function(){$(this).removeClass("phone_only_hover")})}};var MultReco=function(prdId,front,type){this.prdId=prdId;this.front=front;this.type=type;this.doSend=false;this.doReceive=false;this.queueModules=[];this.data={};var oThis=this;this.modules={alsobuy:{jq:$("#alsobuy"),beforeSend:function(){oThis.commBeforeSend(this.jq)},getRequestParams:function(){return{"alsobuy[alsobuy_max_pic]":this.getAlsobuyMaxPic(),"alsobuy[abtest]":$("#pid_span").attr("abtest")}},getAlsobuyMaxPic:function(){var alsobuy_max_pic=5;if(window.iswidth==false){alsobuy_max_pic=4}return alsobuy_max_pic},success:function(data){if(this.jq.length<1){return}if(data.length>0){$("#alsobuy").html(data);oThis.exposureAdURL("alsobuy");if(oThis.front=="ebook"||oThis.front=="publish"){var countalsobuy=$("#alsobuy_pic ul").children().length;if(countalsobuy>this.getAlsobuyMaxPic()){$("#alsobuy_pic").ddcycle({fx:"scrollHorz",timeout:0,speed:500,next:"#alsobuy_pic_next",prev:"#alsobuy_pic_pre",prevNextClick:this.toggleBtn})}else{$("#alsobuy_pic_pre").removeClass("prev").addClass("prev_none").removeAttr("title");$("#alsobuy_pic_next").removeClass("next").addClass("next_none").removeAttr("title")}}}else{$("#alsobuy").html("");$("#alsobuy").hide()}},toggleBtn:function(isNext,index,slide){if(isNext&&index==slide.length-1){$("#alsobuy_pic_next").hide();$("#a_alsobuy_pic_next").show()}else{$("#alsobuy_pic_next").show();$("#a_alsobuy_pic_next").hide()}if(!isNext&&index==0){$("#alsobuy_pic_pre").hide();$("#a_alsobuy_pic_pre").show()}else{$("#alsobuy_pic_pre").show();$("#a_alsobuy_pic_pre").hide()}$("#alsobuy_now_page").html(index+1)}},alsoview:{jq:$("#alsoview"),beforeSend:function(){oThis.commBeforeSend(this.jq)},success:function(data){oThis.commSuccess(this.jq,data)},getRequestParams:function(){return{"alsoview[abtest]":$("#pid_span").attr("abtest")}}},buyafterview:{jq:$("#buyafterview"),beforeSend:function(){oThis.commBeforeSend(this.jq)},success:function(data){oThis.commSuccess(this.jq,data)}},pub2mall:{jq:$("#pub2mall"),beforeSend:function(){oThis.commBeforeSend(this.jq)},success:function(data){oThis.commSuccess(this.jq,data)}},hot_products:{jq:$("#hot_products"),beforeSend:function(){oThis.commBeforeSend(this.jq)},success:function(data){oThis.commSuccess(this.jq,data)},getRequestParams:function(){return{"hot_products[hot_products_max_pic]":(window.iswidth?5:4)}},toggleBtn:function(isNext,index,slide){if(isNext){if(index==slide.length-1){$("#hot_products_pic_next").removeClass("next").addClass("next_none").removeAttr("title")}if($("#hot_products_pic_pre").attr("class").indexOf("prev_none")>=0){$("#hot_products_pic_pre").removeClass("prev_none").addClass("prev").attr("title","上一页")}}else{if(index==0){$("#hot_products_pic_pre").removeClass("prev").addClass("prev_none").removeAttr("title")}if($("#hot_products_pic_next").attr("class").indexOf("next_none",0)>=0){$("#hot_products_pic_next").removeClass("next_none").addClass("next").attr("title","下一页")}}$("#hot_products_now_page").html(index+1)}},nostockreco:{jq:$("#nostockreco"),beforeSend:function(){},getRequestParams:function(){var papertype="wide";if(window.iswidth==false){papertype="narrow"}return{"nostockreco[papertype]":papertype}},success:function(data){oThis.commSuccess(this.jq,data)}},packagediv:{jq:$("#packagediv"),beforeSend:function(){},getRequestParams:function(){var papertype="wide";if(window.iswidth==false){papertype="narrow"}return{"packagediv[papertype]":papertype,"packagediv[abtest]":$("#pid_span").attr("abtest")}},success:function(data){if(!data||data.packageflag==0){this.jq.hide()}this.jq.html(data.html);oThis.exposureAdURL("packagediv");if(data.packageflag==3){$("#pkname").addClass("on");$("#pkname").show();Newpackageinfo.init();Newpackageinfo.callback(data.packageflag)}if(data.packageflag==2){Newpackageinfo.init();Newpackageinfo.callback(data.packageflag)}if(data.packageflag==1||data.packageflag==3){var value=0;if($("#npkname").attr("value")!=undefined){value=$("#npkname").attr("flag")}if(typeof Package.packageJson!="object"&&data.packagejson.length>0){eval("Package.packageJson="+data.packagejson)}Package.bind();if(value==0){$("#pkname").attr("value",1);$("#pkname").addClass("on");$("#pkname").show();$("#pk").show()}else{$("#pkname").show()}}}},pb2bh_interest:{jq:$("#pb2bh_interest"),beforeSend:function(){oThis.commBeforeSend(this.jq)},success:function(data){oThis.commSuccess(this.jq,data)}},pb2bh_relate:{jq:$("#pb2bh_relate"),beforeSend:function(){oThis.commBeforeSend(this.jq)},success:function(data){oThis.commSuccess(this.jq,data)}},recommendnew:{jq:$("#recommendnew"),beforeSend:function(){},success:function(data){oThis.commSuccess(this.jq,data)}},relatebrand:{jq:$("#relatebrand"),beforeSend:function(){},success:function(data){if(this.jq.length<1){return}if(data.length>0){this.jq.html(data);oThis.exposureAdURL("relatebrand");this.jq.attr("class","abox")}else{this.jq.html("");this.jq.hide()}}},relatecate:{jq:$("#relatecate"),beforeSend:function(){oThis.commBeforeSend(this.jq)},success:function(data){if(this.jq.length<1){return}if(data.length>0){this.jq.html(data);this.jq.attr("class","abox")}else{this.jq.html("");this.jq.hide()}}},saletop:{jq:$("#saletop"),beforeSend:function(){oThis.commBeforeSend(this.jq)},getRequestParams:function(){return{"saletop[abtest]":$("#pid_span").attr("abtest")}},success:function(data){if(this.jq.length<1){return}if(data.length>0){this.jq.html(data);oThis.exposureAdURL("saletop");if($("#pid_span").attr("abtest")=="b"){this.jq.attr("class","abox abox_ranklist")}else{this.jq.attr("class","abox")}}else{this.jq.html("");this.jq.hide()}}}}};MultReco.prototype.commBeforeSend=function(c){if(c.length>0){var b='<div style="text-align: center; margin: 30px 0px;" id="alsobuy_wait" isloaded="1"><img border="0" src="images/loading.gif"> 内容加载中，请稍候...</div>';c.html(b)}};MultReco.prototype.commSuccess=function(d,c){if(d.length<1){return}if(c.length>0){d.html(c);var b=d.attr("id");this.exposureAdURL(b)}else{d.html("");d.hide()}};MultReco.prototype.render=function(c){var b=this.queueModules.slice(0);this.queueModules=[];b.push(c);for(i in b){if(typeof this.data[b[i]]!="undefined"){this.modules[b[i]].success(this.data[b[i]])}else{this.commSuccess(this.modules[b[i]].jq,"")}}};MultReco.prototype.exposureAdURL=function(b){$("#"+b).find("li").each(function(){var c=$(this).attr("per_url");if(c){c=c+"&showdiv="+b;$("body").append('<script src="'+c+'"><\/script>')}})};MultReco.prototype.callback=function(e){if(this.doSend&&this.doReceive){return this.render(e)}else{if(this.doSend&&!this.doReceive){if(typeof this.modules[e].beforeSend=="function"){this.modules[e].beforeSend.apply(this.modules[e],[])}return this.queueModules.push(e)}}this.doSend=true;var c=this.modules;var b={product_id:this.prdId};var d=this;for(a in c){if(typeof c[a].getRequestParams=="function"){$.extend(b,c[a].getRequestParams())}}if(typeof c[e].beforeSend=="function"){c[e].beforeSend.apply(c[e],[])}$.ajax({url:"/multreco.php",data:b,type:"GET",cache:false,success:function(f){d.doReceive=true;if(f){d.data=f}d.render(e);if(!f||d.front!="mall"||typeof f.ranking=="undefined"||typeof f.ranking.alsobuy=="undefined"||typeof f.ranking.alsoview=="undefined"||f.ranking.alsobuy==f.ranking.alsoview){return}if(f.ranking.alsobuy<f.ranking.alsoview){$("#alsobuy").after($("#alsoview"))}},error:function(){d.doReceive=true;d.commSuccess(c[e].jq,"")},dataType:"json"})};var ddproduct={productid:"",loadbothbuy:function(){Bothbuy.init();Bothbuy.callback("product_id="+ddproduct.productid)},loadhistory:function(){History.init();History.callback("product_id="+ddproduct.productid)},loadprdcategory:function(){Prdcategory.init();Prdcategory.callback("product_id="+ddproduct.productid)}};$(document).ready(function(){var c=$("#pid_span").attr("product_id");var e=$("#pid_span").attr("FRONT");var d=$("#pid_span").attr("type");var b=new MultReco(c,e,d);ddproduct.productid=c;$("#bothbuy").ddlazyload({func:ddproduct.loadbothbuy});$("#alsobuy").ddlazyload({func:function(){b.callback("alsobuy")}});$("#alsoview").ddlazyload({func:function(){b.callback("alsoview")}});$("#buyafterview").ddlazyload({func:function(){b.callback("buyafterview")}});$("#packagediv").ddlazyload({func:function(){b.callback("packagediv")}});$("#recommendnew").ddlazyload({func:function(){b.callback("recommendnew")}});$("#history").ddlazyload({func:ddproduct.loadhistory});$("#prdcategory").ddlazyload({func:ddproduct.loadprdcategory});Title.init();Title.bind();Mainimg.bind();Promotion.init();Promotion.bind();PriceStock.init();PriceStock.bind();Operation.init();Operation.bind();Detail.init();Detail.bind()});