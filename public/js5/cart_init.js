var PRODUCT_PAGE="http://product.dangdang.com/";var PRODUCT_IMAGE="http://img3x{0}.ddimg.cn/{1}/{2}/{3}-1_x.jpg";var PRODUCT_IMAGE_L="http://img3x{0}.ddimg.cn/{1}/{2}/{3}-1_l.jpg";var PRODUCT_IMAGE_F="http://img3x{0}.ddimg.cn/{1}/{2}/{3}-1_f.jpg";var PRODUCT_IMAGE_B="http://img3x{0}.ddimg.cn/{1}/{2}/{3}-1_b.jpg";var COLLECT_PAHE="http://wish.dangdang.com/wishlist/cust_wish_list.aspx";var Tools={trim:function(a){return a.replace(/^\s+|\s+$/g,"")},nTrunc:function(b,h,l){if(b==null||h==0){return null}var f=b.length;var g=0;var d=0;var k=new StringBuilder();var a="...";if(l){a=l}for(var e=0;e<f;e++){if(b.charCodeAt(e)>127){d++}d++;if((d%2==0?d:d+1)>h*2){return k.append(a).toString()}k.append(b.charAt(e))}return k.toString()},cookiefun:function(b,j,m){if(typeof j!="undefined"){m=m||{};var e="";if(typeof m.expires=="number"){var f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000));e="; expires="+f.toGMTString()}var l=m.path?"; path="+m.path:"; path=/";var g=m.domain?"; domain="+m.domain:"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("");return null}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=Tools.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}}};var TPL={PriceTip:{Item:'<a href="'+PRODUCT_PAGE+'{product_id}.html#midcart" title="{product_name}" target="_blank">{p_short_name}</a>，已由原来的<span class="redtip">&yen;{entered_price}</span>降到了<span class="redtip">&yen;{sale_price}</span>，您可以现在购买。'},AlsoBuy:{Header:'<div class="shoppingcart_promotions_info"><div style="width: 920px; height: 240px; overflow: hidden;" sid="alsobuy_slider" class="shoppingcart_promotions_info_ul"><ul style="width: 1656px;" sid="ul_AlsoBuyList">',Header2:'<div class="shoppingcart_promotions_info" style = "height: 563px;"><div style="width: 920px; height: 563px; overflow: hidden;" sid="alsobuy_slider" class="shoppingcart_promotions_info_ul"><ul style="height: 561px; overflow: hidden;" sid="ul_AlsoBuyList" class = "">',Header3:'<div class="shoppingcart_promotions_info"><div style="width: 920px; height: 563px; overflow: hidden;" sid="alsoview_slider" class="shoppingcart_promotions_info_ul"><ul style="height: 561px; overflow: hidden;" sid="ul_AlsoViewList" class = "">',Header4:'<div class="shoppingcart_promotions_info"><div style="width: 920px; height: 563px; overflow: hidden;" sid="alsobuycart_slider" class="shoppingcart_promotions_info_ul"><ul style="height: 561px; overflow: hidden;" sid="ul_AlsoBuyCartList" class = "">',Header5:'<div class="shoppingcart_promotions_info"><div style="width: 920px; height: 563px; overflow: hidden;" sid="importance_slider" class="shoppingcart_promotions_info_ul"><ul style="height: 561px; overflow: hidden;" sid="ul_Importance" class = "">',Item:'<li style="float: left;"><p class="pic"><a name="productpic_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuy" target="_blank" title="{name}"><img src="{product_image}" /></a></p><p class="name"><a name="product_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuy" target="_blank" title="{name}">{p_short_name}</a></p><p class="price"><span class="price_d">&yen;{sale_price}</span><span class="price_m">{original_price}</span></p><p class="buy"><a name="movetoshoppingcart_alsobuy" href="javascript:void(0);" onclick="objCart.addToCart({product_id},this,\'alsobuy\')">放入购物车</a> </p></li>',Item2:'<div class="pic"><a name="productpic_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuy" target="_blank" title="{name}" dd_name="查看详情"><img src="{product_image}" /></a></div><div class="price_d">&yen;{sale_price}</div><div class="name"><a name="product_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuy" target="_blank" title="{name}{author_name}">{p_short_name}</a></div><div class="bought"><span title="{reason}">{reason}</span></div><div class="pinlun"><span class="star"><span style="width:{score};"></span></span><a href="'+PRODUCT_PAGE+'{product_id}.html?ddclick_reco_midcart_alsobuy#comment" target = "_blank">{review}条评论</a></div><div class="btn"><a href="cart_init_new?ad_id=midcart_alsobuy&amp;product_ids={product_id}#ddclick_reco_midcart_alsobuy" target = "_blank" dd_name="加入购物车按钮">加入购物车</a></div>',Item2_1:'<div class="pic"><a name="productpic_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuy" target="_blank" title="{name}" dd_name="查看详情"><img src="{product_image}" /></a></div><div class="price_d">&yen;{sale_price}</div><div class="name"><a name="product_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuy" target="_blank" title="{name}{author_name}">{p_short_name}</a></div><div class="bought"><span title="{reason}">{reason}</span></div><div class="pinlun"><span class="star"><span style="width:{score};"></span></span><a href="'+PRODUCT_PAGE+'{product_id}.html?ddclick_reco_midcart_alsobuy#comment" target = "_blank">{review}条评论</a></div><div class="btn"><a href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuy" target = "_blank" dd_name="查看详情">查看商品详情</a></div>',Item3:'<div class="pic"><a name="productpic_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsoview" target="_blank" title="{name}" dd_name="查看详情"><img src="{product_image}" /></a></div><div class="price_d">&yen;{sale_price}</div><div class="name"><a name="product_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsoview" target="_blank" title="{name}{author_name}">{p_short_name}</a></div><div class="bought"><span title="{reason}">{reason}</span></div><div class="pinlun"><span class="star"><span style="width:{score};"></span></span><a href="'+PRODUCT_PAGE+'{product_id}.html?ddclick_reco_midcart_alsoview#comment" target = "_blank">{review}条评论</a></div><div class="btn"><a href="cart_init_new?ad_id=midcart_alsoview&amp;product_ids={product_id}#ddclick_reco_midcart_alsoview" target = "_blank" dd_name="加入购物车按钮">加入购物车</a></div>',Item3_1:'<div class="pic"><a name="productpic_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsoview" target="_blank" title="{name}" dd_name="查看详情"><img src="{product_image}" /></a></div><div class="price_d">&yen;{sale_price}</div><div class="name"><a name="product_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsoview" target="_blank" title="{name}{author_name}">{p_short_name}</a></div><div class="bought"><span title="{reason}">{reason}</span></div><div class="pinlun"><span class="star"><span style="width:{score};"></span></span><a href="'+PRODUCT_PAGE+'{product_id}.html?ddclick_reco_midcart_alsoview#comment" target = "_blank">{review}条评论</a></div><div class="btn"><a href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsoview" target = "_blank" dd_name="查看详情">查看商品详情</a></div>',Item4:'<li style="float: left;"><div><a name="productpic_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuycart" target="_blank" title="{name}" class = "goods_img"><img src="{product_image}" /></a></div><div class="goods_name"><a name="product_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_alsobuycart" target="_blank" title="{name}{author_name}">{p_short_name}</a></div><p class="price"><span class="price_n">&yen;{sale_price}</span><span class="price_m">{original_price}</span></p><p class="fraction"><span class="level"><span style="width: {score};"></span></span><a href="'+PRODUCT_PAGE+'{product_id}.html?ddclick_reco_midcart_alsobuycart#comment" class="fraction_num" target = "_blank">{review}</a>条评论</p><p><a name="movetoshoppingcart_alsobuy" href="cart_init_new?ad_id=midcart_alsobuycart&amp;product_ids={product_id}" class = "add_btn">放入购物车</a></p></li>',Item5:'<li style="float: left;"><div><a name="productpic_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_recobar" target="_blank" title="{name}" class = "goods_img"><img src="{product_image}" /></a></div><div class="goods_name"><a name="product_alsobuy" href="'+PRODUCT_PAGE+'{product_id}.html#ddclick_reco_midcart_recobar" target="_blank" title="{name}">{p_short_name}</a></div><p class="price"><span class="price_n">&yen;{sale_price}</span><span class="price_m">{original_price}</span></p><p class="fraction"><span class="level"><span style="width: {score};"></span></span><a href="'+PRODUCT_PAGE+'{product_id}.html?ddclick_reco_midcart_recobar#comment" class="fraction_num" target = "_blank">{review}</a>条评论</p><p><a name="movetoshoppingcart_alsobuy" href="cart_init_new?ad_id=midcart_recobar&amp;product_ids={product_id}" class = "add_btn">放入购物车</a></p></li>',Footer:'</ul></div><br class="clear"></div>'}};var StringBuilder=function(a){this.s=new Array(a);this.onMultiAppendBeforeHandle=null;this.onMultiAppendBefore=function(b){this.onMultiAppendBeforeHandle=b;return this};this.append=function(b){this.s.push(b);return this};this.toString=function(){return this.s.join("")};this.clear=function(){this.s=new Array()};this.appendMultiFormat=function(c,d){if(typeof(d)=="object"){for(var b in d){if(this.onMultiAppendBeforeHandle!=null){this.onMultiAppendBeforeHandle(d[b])}this.appendFormat(c,d[b])}}return this};this.appendFormat=function(){var o=arguments.length;if(o==0){return this}var j=arguments[0];if(o==1){return this.append(j)}var b=arguments[1];if(b==null){b=""}var g,l,m,d,h;if(typeof(b)=="object"){h=function(c,e){return c[1][e]}}else{h=function(c,e){return c[e-0+1]}}for(g=0;g<j.length;){m=j.charAt(g);if(m=="{"){l=j.indexOf("}",g);d=j.substring(g+1,l);this.s.push(h(arguments,d));g=l+1;continue}this.s.push(m);g++}return this}};function PriceReduction(){var a=this;this.onItemDataBind=function(c){var b=c.product_id;c.p_short_name=Tools.nTrunc(c.product_name,12);c.entered_price=parseFloat(c.entered_price).toFixed(2);c.sale_price=parseFloat(c.sale_price).toFixed(2)};this.show=function(){if(!isUserLogin){return}try{$.ajax({url:AJAX_URL,data:"funcName=getPriceReduction",dataType:"json",success:function(c){try{if(c.num==0||!c||typeof(c)==undefined||c==undefined||c==null){$('[sid="priceTip"]').hide();return}a.DataSource=c.info[0];a.DataSource=[a.DataSource];var f=new StringBuilder("").onMultiAppendBefore(a.onItemDataBind).appendMultiFormat(TPL.PriceTip.Item,a.DataSource).toString();f="购物提示：您收藏夹的"+f+'另有<b class="redtip">'+c.num+'</b>款商品也已降价，点击&nbsp;<a href="'+COLLECT_PAHE+'">收藏夹</a>&nbsp;查看所有降价商品！';$('[sid="priceTip"]').html(f);$('[sid="priceTip"]').show();a.DataSource=null}catch(d){}},error:function(){}})}catch(b){}}}function AlsoBuy(){var a=this;this.DataSource=null;this.isShow_locListDiv=false;this.totalMoney=0;this.onItemDataBind=function(c){var b=c.product_id;c.product_image=new StringBuilder("").appendFormat(PRODUCT_IMAGE_B,b%10,b%99,b%37,b).toString();c.author_name=c.author_name?c.author_name:"";if(c.author_name!=""){c.p_short_name=c.name?c.name+"【"+c.author_name+"】":c.product_name+"【"+c.author_name+"】"}else{c.p_short_name=c.name?c.name:c.product_name}c.original_price=c.original_price?"&yen;"+(c.original_price/100).toFixed(2):c.is_show_discount==1?"&yen;"+c.origin_price:"";c.sale_price=c.dd_price?parseFloat(c.dd_price).toFixed(2):(c.sale_price/100).toFixed(2);c.shop_id=0;c.reason=c.reason?c.reason:"";c.name=c.product_name;c.review=c.review_cnt?c.review_cnt:"0";c.score=c.score*10+"%"};this.show=function(m){var j="jsonp",b="",i="",l=0,d=0,f="",c=(m&&m.url)||ALSOBUY_URL,k=(m&&m.from)||"cart",h=(m&&m.type)||"alsobuy";c+="&ref="+k+"&perm_id="+Tools.cookiefun("__permanent_id")+"&pids=";switch(h){case"alsobuy":f=addProID;if(IS_ALSO_BUY_LIST==0||!addProID){$('[sid="divAlsoBuyList"]').hide();return}b="margin-top: 273px;";break;case"alsoview":f=addProID;if(IS_ALSO_VIEW_LIST==0||!addProID){$('[sid="divAlsoViewList"]').hide();return}break;case"alsobuycart":if(IS_ALSO_BUY_CART_LIST==0||arCartIDs.length==0){$('[sid="divAlsoBuyCart"]').hide();return}f=arCartIDs.join(",");break;case"importance":f=f=Tools.cookiefun("producthistoryid");if(IS_IMPORTANCE_LIST==0||arCartIDs.length==0||!f){$('[sid="importance"]').hide();return}break;default:break}try{$.ajax({url:c+f+"&js_func=?",dataType:j,success:function(n){try{switch(h){case"alsobuy":if(!n||typeof(n)==undefined||n==undefined||n==null||n.code!=0||n.data.total_count<8||n.data.page_size<8||typeof(n.data)==undefined){$("#J_alsobuy").hide();return false}a.DataSource=n.data.items;$("#J_alsobuy").show();d=Math.min(n.data.page_size,n.data.total_count);l=Math.ceil((d/8));$("#J_alsobuy .J_totalPage").html(l);for(var o=l+1;o<=6;o++){$("#J_alsobuy .recommend_fanye span:nth-child("+o+")").css("display","none")}for(var o=0;o<d;o++){a.onItemDataBind(a.DataSource[o]);if(o%8===0){i+='<div class="lie" >';i+='<li onmouseover="this.className=\'hover_pic\'" onmouseout="this.className=\'\'" id="li'+o+'">';if(1===a.DataSource[o].is_catalog_product){i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item2_1,a.DataSource[o])}else{i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item2,a.DataSource[o])}i+="</li>"}else{if(o%8===7){i+='<li onmouseover="this.className=\'hover_pic\'" onmouseout="this.className=\'\'" id="li'+o+'" >';if(1===a.DataSource[o].is_catalog_product){i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item2_1,a.DataSource[o])}else{i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item2,a.DataSource[o])}i+="</li>";i+="</div>"}else{i+='<li onmouseover="this.className=\'hover_pic\'" onmouseout="this.className=\'\'" id="li'+o+'" >';if(1===a.DataSource[o].is_catalog_product){i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item2_1,a.DataSource[o])}else{i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item2,a.DataSource[o])}i+="</li>"}}}$("#J_alsobuy").css("display","block");$("#J_alsobuy #J_alsobuyWrap ul").html(i);$("#J_alsobuyWrap").commSlider({auto:false,continuous:true,prevId:"prevBtn_alsobuy",nextId:"nextBtn_alsobuy",lastId:"lastBtn_alsobuy",firstId:"firstBtn_alsobuy",fanyeId:"J_alsobuy .recommend_fanye span",currentPage:1,totalPage:l});if(1==l){$("#prevBtn_alsobuy,#nextBtn_alsobuy,#J_alsobuy .recommend_fanye span").css("display","none")}$("#J_alsobuyWrap").css({height:"812px",width:"918px"});break;case"alsoview":if(!n||typeof(n)==undefined||n==undefined||n==null||n.code!=0||n.data.total_count<3||n.data.page_size<3||typeof(n.data)==undefined){$("#J_alsoview").hide();return false}a.DataSource=n.data.items;$("#J_alsoview").show();d=Math.min(n.data.page_size,n.data.total_count);l=Math.ceil((d/4));$("#J_alsoview .J_totalPage").html(l);for(var o=l+1;o<=6;o++){$("#J_alsoview .recommend_fanye span:nth-child("+o+")").css("display","none")}for(var o in a.DataSource){a.onItemDataBind(a.DataSource[o]);if(o%4===0){i+='<div class="lie" >';i+='<li onmouseover="this.className=\'hover_pic\'" onmouseout="this.className=\'\'" id="li'+o+'">';if(1===a.DataSource[o].is_catalog_product){i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item3_1,a.DataSource[o])}else{i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item3,a.DataSource[o])}i+="</li>"}else{if(o%4===3){i+='<li onmouseover="this.className=\'hover_pic\'" onmouseout="this.className=\'\'" id="li'+o+'" >';if(1===a.DataSource[o].is_catalog_product){i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item3_1,a.DataSource[o])}else{i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item3,a.DataSource[o])}i+="</li>";i+="</div>"}else{i+='<li onmouseover="this.className=\'hover_pic\'" onmouseout="this.className=\'\'" id="li'+o+'" >';if(1===a.DataSource[o].is_catalog_product){i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item3_1,a.DataSource[o])}else{i+=new StringBuilder("").appendFormat(TPL.AlsoBuy.Item3,a.DataSource[o])}i+="</li>"}}}$("#J_alsoview").css("display","block");$("#J_alsoview #J_alsoviewWrap ul").html(i);$("#J_alsoviewWrap").commSlider({auto:false,continuous:true,prevId:"prevBtn_alsoview",nextId:"nextBtn_alsoview",lastId:"lastBtn_alsoview",firstId:"firstBtn_alsoview",fanyeId:"J_alsoview .recommend_fanye span",currentPage:1,totalPage:l});$("#J_alsoviewWrap").css({height:"406px",width:"918px"});if(1==l){$("#prevBtn_alsoview,#nextBtn_alsoview,#J_alsoview .recommend_fanye span").css("display","none")}break;case"alsobuycart":if(!n||typeof(n)==undefined||n==undefined||n==null||n.code!=0||n.data.total_count<3){$("#J_alsobuycart").hide();return}a.DataSource=n.data.items;$("#J_alsobuycart").show();d=Math.min(n.data.page_size,n.data.total_count);l=Math.ceil((d/5));$("#J_alsobuycart .J_totalPage").html(l);i=new StringBuilder("").onMultiAppendBefore(a.onItemDataBind).appendMultiFormat(TPL.AlsoBuy.Item4,a.DataSource).toString();$("#J_alsobuycart #J_alsobuycartWrap ul").html(i);$("#J_alsobuycartWrap").commSlider({auto:false,continuous:true,prevId:"prevBtn_alsobuycart",nextId:"nextBtn_alsobuycart",lastId:"lastBtn_alsobuycart",firstId:"firstBtn_alsobuycart",currentPage:1,totalPage:l});break;case"importance":if(!n||typeof(n)==undefined||n==undefined||n==null||n.code!=0||n.data.total_count<3){$('#J_importance"]').hide();return}a.DataSource=n.data.items;$("#J_importance").show();d=Math.min(n.data.page_size,n.data.total_count);l=Math.ceil((d/5));$("#J_importance .J_totalPage").html(l);i=new StringBuilder("").onMultiAppendBefore(a.onItemDataBind).appendMultiFormat(TPL.AlsoBuy.Item5,a.DataSource).toString();$("#J_importance #J_importanceWrap ul").html(i);$("#J_importanceWrap").commSlider({auto:false,continuous:true,prevId:"prevBtn_importance",nextId:"nextBtn_importance",lastId:"lastBtn_importance",firstId:"firstBtn_importance",currentPage:1,totalPage:l});break;default:break}}catch(p){if(h==="alsobuy"||h==="initalsobuy"){$('[sid="divAlsoBuyList"]').hide()}else{if(h==="alsoview"){$('[sid="divAlsoViewList"]').hide()}else{if(h==="alsobuycart"){$('[sid = "divAlsoBuyCart"]').hide()}else{$('[sid = "divImportance"]').hide()}}}}}})}catch(g){if(h==="alsobuy"||h==="initalsobuy"){$('[sid="div_AlsoBuyList"]').hide()}else{if(h==="alsoview"){$('[sid="divAlsoViewList"]').hide()}else{if(h==="alsobuycart"){$('[sid = "div_AlsoBuyCart"]').hide()}else{$('[sid = "div_importance"]').hide()}}}}}};